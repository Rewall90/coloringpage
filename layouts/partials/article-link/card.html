{{ $disableImageOptimization := .Page.Site.Params.disableImageOptimization | default false }}
<div
  class="group-hover-card group relative min-h-full min-w-full overflow-hidden rounded border border-2 border-neutral-200 shadow-2xl dark:border-neutral-700">
  <a
    {{ partial "article-link/_external-link.html" . | safeHTMLAttr }}
    class="absolute inset-0"
    aria-label="{{ $.Title }}"></a>
  
  {{/* Hero Image Section - Using proper <img> tags for SEO */}}
  {{ $featuredImage := .Params.featureimage }}
  {{ $imageAlt := .Params.image_alt | default .Title }}
  {{ $imageWidth := .Params.image_width | default 600 }}
  {{ $imageHeight := .Params.image_height | default 400 }}
  {{ $imageSrcset := .Params.image_srcset }}
  
  {{ if $featuredImage }}
    {{/* Category pages with hierarchical image URLs */}}
    <figure class="w-full overflow-hidden aspect-[16/9]">
      <img 
        decoding="async"
        loading="lazy"
        src="{{ $featuredImage }}"
        alt="{{ $imageAlt }}"
        width="{{ $imageWidth }}"
        height="{{ $imageHeight }}"
        class="w-full h-full object-cover"
        {{ if $imageSrcset }}
        srcset="{{ $imageSrcset }}"
        sizes="(max-width: 600px) 480px, (max-width: 1024px) 768px, 600px"
        {{ end }}
      />
    </figure>
  {{ else }}
    {{/* Fallback for posts without hierarchical URLs */}}
    {{ $heroImage := .Params.image }}
    {{ if $heroImage }}
      <figure class="w-full overflow-hidden aspect-[16/9]">
        <img 
          decoding="async"
          loading="lazy"
          src="{{ $heroImage }}"
          alt="{{ $imageAlt }}"
          class="w-full h-full object-cover"
        />
      </figure>
    {{ else }}
      {{/* Hugo resource-based images (posts) */}}
      {{- $images := $.Resources.ByType "image" -}}
      {{- $featured := $images.GetMatch "*feature*" -}}
      {{- if not $featured }}{{ $featured = $images.GetMatch "{*cover*,*thumbnail*}" }}{{ end -}}
      {{ if and .Params.featureimage (not $featured) }}
        {{- $url:= .Params.featureimage -}}
        {{ $featured = resources.GetRemote $url }}
      {{ end }}
      {{- if not $featured }}
        {{ with .Site.Params.defaultFeaturedImage }}{{ $featured = resources.Get . }}{{ end }}
      {{ end -}}
      {{ if .Params.hideFeatureImage }}{{ $featured = false }}{{ end }}
      {{- with $featured -}}
        <figure class="w-full overflow-hidden aspect-[16/9]">
          {{ if or $disableImageOptimization (strings.HasSuffix $featured ".svg") }}
            <img 
              decoding="async"
              loading="lazy"
              src="{{ .RelPermalink }}"
              alt="{{ $imageAlt }}"
              class="w-full h-full object-cover"
            />
          {{ else }}
            {{ with .Resize "600x" }}
              <img 
                decoding="async"
                loading="lazy"
                src="{{ .RelPermalink }}"
                alt="{{ $imageAlt }}"
                class="w-full h-full object-cover"
              />
            {{ end }}
          {{ end }}
        </figure>
      {{- else -}}
        {{/* No image available - show placeholder */}}
        <div class="w-full aspect-[16/9] bg-gradient-to-br from-primary-400 to-primary-600 flex items-center justify-center">
          <span class="text-white text-lg font-medium">{{ .Title }}</span>
        </div>
      {{- end -}}
    {{ end }}
  {{ end }}
  
  {{/* Draft Badge */}}
  {{ if and .Draft .Site.Params.article.showDraftLabel }}
    <span class="absolute top-0 right-0 m-2">
      {{ partial "badge.html" (i18n "article.draft" | emojify) }}
    </span>
  {{ end }}
  
  {{/* Content Section */}}
  <div class="px-6 py-4">
    {{ with .Params.externalUrl }}
      <h3
        class="group-hover-card-title decoration-primary-500 dark:text-neutral text-xl font-bold text-neutral-800 group-hover:underline group-hover:underline-offset-2">
        {{ $.Title | emojify }}
        <span class="cursor-default align-top text-xs text-neutral-400 dark:text-neutral-500">
          <span class="rtl:hidden">&#8599;</span>
          <span class="ltr:hidden">&#8598;</span>
        </span>
      </h3>
    {{ else }}
      <h3
        class="group-hover-card-title decoration-primary-500 dark:text-neutral text-xl font-bold text-neutral-800 group-hover:underline group-hover:underline-offset-2">
        {{ .Title | emojify }}
      </h3>
    {{ end }}
  </div>
</div>