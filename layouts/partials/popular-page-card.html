{{ $disableImageOptimization := .Page.Site.Params.disableImageOptimization | default false }}
<div
  class="group-hover-card group relative min-h-full min-w-full overflow-hidden rounded border border-2 border-neutral-200 shadow-2xl dark:border-neutral-700">
  <a
    {{ partial "article-link/_external-link.html" . | safeHTMLAttr }}
    class="absolute inset-0"
    aria-label="{{ $.Title }}"></a>
  
  {{/* Hero Image Section - Using hero_image for landscape display */}}
  {{ $featuredImage := .Params.featureimage }}
  {{ $imageAlt := .Params.image_alt | default .Title }}
  {{ $imageWidth := 1312 }}
  {{ $imageHeight := 656 }}
  {{ $imageSrcset := .Params.image_srcset }}
  
  {{ if or $featuredImage .Params.hero_image .Params.image_width }}
    {{/* Popular pages use landscape hero images */}}
    <figure class="w-full overflow-hidden aspect-[2/1]">
      {{ $localImageUrl := "" }}
      {{ if .Params.hero_image }}
        {{/* Use hero_image for popular pages - 1312x656 landscape format */}}
        {{ $localImageUrl = .Params.hero_image }}
      {{ else if .Params.image_width }}
        {{/* Fallback to original logic for non-hero pages */}}
        {{ if eq .Type "coloring-category" }}
          {{ $localImageUrl = printf "/images/categories/%s.webp" .Section }}
        {{ else }}
          {{/* Use cardImage if available, otherwise fall back to hero image */}}
          {{ if .Params.card_image }}
            {{ $localImageUrl = .Params.card_image }}
            {{ if .Params.card_image_alt }}
              {{ $imageAlt = .Params.card_image_alt }}
            {{ end }}
          {{ else }}
            {{ $localImageUrl = printf "/images/collections/%s/%s/hero.webp" .Section (path.BaseName .RelPermalink) }}
          {{ end }}
        {{ end }}
      {{ else }}
        {{ $localImageUrl = $featuredImage }}
      {{ end }}
      
      {{ if $localImageUrl }}
        <noscript>
          <img decoding="async" 
               src="{{ $localImageUrl }}" 
               alt="{{ $imageAlt }}"
               width="{{ $imageWidth }}"
               height="{{ $imageHeight }}"
               sizes="(max-width: 600px) 100vw, 600px">
        </noscript>
        <img decoding="async" 
             width="{{ $imageWidth }}"
             height="{{ $imageHeight }}"
             src="{{ $localImageUrl }}" 
             alt="{{ $imageAlt }}"
             class="w-full h-full object-cover"
             data-pin-url="{{ absURL .RelPermalink }}"
             data-pin-title="{{ .Title }} | {{ site.Title }}"
             data-pin-description="{{ .Summary | default "Free, premium printable coloring pages for kids. Easy access and zero cost for endless fun and creativity!" }}"
             loading="lazy">
      {{ else if $featuredImage }}
        {{/* Fallback to existing image logic */}}
        <img 
          decoding="async"
          loading="lazy"
          src="{{ $featuredImage }}"
          alt="{{ $imageAlt }}"
          width="{{ $imageWidth }}"
          height="{{ $imageHeight }}"
          class="w-full h-full object-contain"
          {{ if $imageSrcset }}
          srcset="{{ $imageSrcset }}"
          sizes="(max-width: 600px) 480px, (max-width: 1024px) 768px, 600px"
          {{ end }}
        />
      {{ end }}
    </figure>
  {{ else }}
    {{/* Fallback for posts without hierarchical URLs */}}
    {{ $heroImage := .Params.image }}
    {{ if $heroImage }}
      <figure class="w-full overflow-hidden aspect-[2/1]">
        <img 
          decoding="async"
          loading="lazy"
          src="{{ $heroImage }}"
          alt="{{ $imageAlt }}"
          class="w-full h-full object-contain"
        />
      </figure>
    {{ else }}
      {{/* Hugo resource-based images (posts) */}}
      {{- $images := $.Resources.ByType "image" -}}
      {{- $featured := $images.GetMatch "*feature*" -}}
      {{- if not $featured }}{{ $featured = $images.GetMatch "{*cover*,*thumbnail*}" }}{{ end -}}
      {{ if and .Params.featureimage (not $featured) }}
        {{- $url:= .Params.featureimage -}}
        {{ $featured = resources.GetRemote $url }}
      {{ end }}
      {{- if not $featured }}
        {{ with .Site.Params.defaultFeaturedImage }}{{ $featured = resources.Get . }}{{ end }}
      {{ end -}}
      {{ if .Params.hideFeatureImage }}{{ $featured = false }}{{ end }}
      {{- with $featured -}}
        <figure class="w-full overflow-hidden aspect-[2/1]">
          {{ if or $disableImageOptimization (strings.HasSuffix $featured ".svg") }}
            <img 
              decoding="async"
              loading="lazy"
              src="{{ .RelPermalink }}"
              alt="{{ $imageAlt }}"
              class="w-full h-full object-contain"
            />
          {{ else }}
            {{ with .Resize "600x" }}
              <img 
                decoding="async"
                loading="lazy"
                src="{{ .RelPermalink }}"
                alt="{{ $imageAlt }}"
                class="w-full h-full object-contain"
              />
            {{ end }}
          {{ end }}
        </figure>
      {{- else -}}
        {{/* No image available - show placeholder */}}
        <div class="w-full aspect-[2/1] bg-gradient-to-br from-primary-400 to-primary-600 flex items-center justify-center">
          <span class="text-white text-lg font-medium">{{ .Title }}</span>
        </div>
      {{- end -}}
    {{ end }}
  {{ end }}
  
  {{/* Draft Badge */}}
  {{ if and .Draft .Site.Params.article.showDraftLabel }}
    <span class="absolute top-0 right-0 m-2">
      {{ partial "badge.html" (i18n "article.draft" | emojify) }}
    </span>
  {{ end }}
  
  {{/* Content Section */}}
  <div class="px-6 py-4">
    {{ with .Params.externalUrl }}
      <h3
        class="group-hover-card-title decoration-primary-500 dark:text-neutral text-xl font-bold text-neutral-800 group-hover:underline group-hover:underline-offset-2">
        {{ $.Title | emojify }}
        <span class="cursor-default align-top text-xs text-neutral-400 dark:text-neutral-500">
          <span class="rtl:hidden">&#8599;</span>
          <span class="ltr:hidden">&#8598;</span>
        </span>
      </h3>
    {{ else }}
      <h3
        class="group-hover-card-title decoration-primary-500 dark:text-neutral text-xl font-bold text-neutral-800 group-hover:underline group-hover:underline-offset-2">
        {{ .Title | emojify }}
      </h3>
    {{ end }}
  </div>
</div>